@inject IJSRuntime JSRuntime

<div class="video-container">
    <video-js id="@Id" class="video-js" controls preload="auto">
        <source src="@Source" type="application/x-mpegURL" />
    </video-js>
</div>

<style>
    .video-container {
        width: 360px;
        height: 640px;
        overflow: hidden;
        position: relative;
    }

    /* Ensure the Video.js player fills the container */
    .video-container .video-js {
        width: 100%;
        height: 100%;
        position: relative;
    }

    /* Position the actual video playback element so it covers and centers */
    .video-container .vjs-tech {
        position: absolute;
        top: 0;
        left: 50%;
        height: 100%;
        width: auto; /* allow natural scaling */
        transform: translateX(-50%);
        object-fit: cover;
        object-position: center;
        z-index: 0;
    }

    /* Ensure the control bar is positioned over the video and fully visible */
    .video-container .vjs-control-bar {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        z-index: 1;
    }

    /* Fix for the quality picker overlay (and other menus) so it isn't cropped */
    .video-js .vjs-menu {
        right: 0 !important;
        left: auto !important;
        overflow: visible !important;
    }
</style>

@code {
    [Parameter]
    public string Source { get; set; } = "";

    [Parameter]
    public string Id { get; set; } = "videoPlayer";

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await Task.Delay(200);
            try
            {
                await JSRuntime.InvokeAsync<object>("initializePlayer", Id);
            }
            catch (Exception ex)
            {
                await JSRuntime.InvokeVoidAsync("console.error", "Error initializing video player:", ex.Message);
            }
        }
    }

    public async ValueTask DisposeAsync()
    {
        try
        {
            await JSRuntime.InvokeVoidAsync("disposePlayer", Id);
        }
        catch { }
    }
} 